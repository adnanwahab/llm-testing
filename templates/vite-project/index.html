
<script>
 console.log(123)


 fetch('./rna.fna').then(req => req.text())
        .then(text => processText(text))


 function processText(text) {
text =text.replace(/\n/g, '')
text =      text.replace('>XM_005758335.1 16PFK1 [organism=Emiliania huxleyi CCMP1516] [GeneID=17252077]', '')
         .split('>XM_005772135.1 26PFK2 [organism=Emiliania huxleyi CCMP1516] [GeneID=17265309]')

     console.log(text)


     text.forEach(renderCanvas)
     
 }



 function renderCanvas(text) {

     var canvas = document.createElement('canvas')

     document.body.append(canvas)



     let ctx = canvas.getContext('2d')
     ctx.canvas.width  = window.innerWidth;
     ctx.canvas.height = window.innerHeight;
     window.ctx = ctx
     


     let kmers = parseText(text)
     ctx.fillRect(0,0, 123, 123 )
     console.log(kmers)
     kmers.forEach(function (coords, i) {
         //ctx.fillStyle = 'blue'
         let [start, end ] = coords;
         console.log(start, end)
         ctx.fillRect(end, 0, 3, 20 )
     })
     //let n = kmers.next()
     //let indices = []
     //while (n) {
     //    n = kmers.next()
     //}
 }

 function parseText (text) {

     var start_codons = 'ATG'
     var end_codons = ['GGC','TTT', 'CAC']

     //intervals = text.matchAll(/ATG.*[GGC][TTT][CAC]/g)
     let intervals = []
     for (let i = 0; i < text.length; i++) {
         let window = text.slice(i, i+3)
         if (window == start_codons) {
             for (let j = 0; j < text.slice(i+3,text.length).length; j++) {
                 let window = text.slice(j, j+3)
                 if (end_codons.indexOf(window) !== -1) {
                     intervals.push([i, j])
                 }
             }
         } 
         
     }
     
     return intervals;
 }
</script>
